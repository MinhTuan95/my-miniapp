<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flutter Web + JS Interop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Quyền truy cập -->
  <meta name="permissions-policy" content="camera=*, microphone=*, geolocation=*, clipboard-read=*, clipboard-write=*">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    button {
      margin: 6px;
      padding: 8px 14px;
      font-size: 16px;
    }
  </style>

  <script>
    // JS gọi Flutter với dữ liệu khác nhau
    function callFlutterWithString() {
      window.flutterInterop?.("Hello from JS");
    }

    function callFlutterWithNumber() {
      window.flutterInterop?.(2025);
    }

    function callFlutterWithArray() {
      window.flutterInterop?.(["one", 2, true]);
    }

    function callFlutterWithObject() {
      const data = {
        name: "OpenAI",
        features: ["AI", "ChatGPT", "Codex"],
        isCool: true,
        year: 2025
      };
      window.flutterInterop?.(JSON.stringify(data)); // hoặc truyền object trực tiếp
    }

    // Quyền truy cập
    async function requestCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        alert("Camera access granted");
        stream.getTracks().forEach(track => track.stop());
      } catch (err) {
        alert("Camera access denied: " + err);
      }
    }

    async function requestMicrophone() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        alert("Microphone access granted");
        stream.getTracks().forEach(track => track.stop());
      } catch (err) {
        alert("Microphone access denied: " + err);
      }
    }

    function requestGeolocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => alert("Geolocation granted: " + pos.coords.latitude + ", " + pos.coords.longitude),
          err => alert("Geolocation denied: " + err.message)
        );
      } else {
        alert("Geolocation not supported");
      }
    }

    async function requestClipboardRead() {
      try {
        const text = await navigator.clipboard.readText();
        alert("Clipboard content: " + text);
      } catch (err) {
        alert("Clipboard read denied: " + err);
      }
    }

    async function requestClipboardWrite() {
      try {
        await navigator.clipboard.writeText("Copied from JS");
        alert("Clipboard write success");
      } catch (err) {
        alert("Clipboard write denied: " + err);
      }
    }
  </script>
</head>
<body>

  <h2>JS → Flutter Interop Test</h2>

  <button onclick="callFlutterWithString()">Call Flutter with String</button>
  <button onclick="callFlutterWithNumber()">Call Flutter with Number</button>
  <button onclick="callFlutterWithArray()">Call Flutter with Array</button>
  <button onclick="callFlutterWithObject()">Call Flutter with Object</button>

  <hr/>

  <h2>Test Permissions</h2>

  <button onclick="requestCamera()">Request Camera</button>
  <button onclick="requestMicrophone()">Request Microphone</button>
  <button onclick="requestGeolocation()">Request Geolocation</button>
  <button onclick="requestClipboardRead()">Read from Clipboard</button>
  <button onclick="requestClipboardWrite()">Write to Clipboard</button>

  <!-- Flutter app script -->
  <script src="main.dart.js" type="application/javascript"></script>

</body>
</html>